{% load static %}
{% load humanize %}

<div class="modal-header stone-modal-header" style="background: linear-gradient(135deg, #efebe9 0%, #d7ccc8 100%); padding: 1.5rem 2rem; border-bottom: 1px solid #E8DCC8; border-radius: 16px 16px 0 0;">
    <div class="d-flex align-items-center gap-3">
        <div class="header-icon-box" style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px); border-radius: 12px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(139, 115, 85, 0.15); color: #6F5B44; font-size: 1.25rem;">
            <i class="fas fa-play"></i>
        </div>
        <div>
            <h5 class="modal-title fw-bold" style="color: #5D4037; font-size: 1.1rem; letter-spacing: -0.5px; margin: 0;">Iniciar Producción</h5>
            <p class="mb-0 text-muted" style="font-size: 0.8rem;">Confirmar inicio de orden {{ orden.numero_orden }}</p>
        </div>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body p-4" style="background: white;">
    <div class="alert alert-soft-primary d-flex align-items-center mb-4" role="alert" style="background-color: #f0f7ff; border: 1px solid #cce5ff; border-radius: 8px; color: #004085;">
        <i class="fas fa-info-circle me-2 fa-lg"></i>
        <div>
            Al iniciar la orden, se registrará la fecha y hora actual como <strong>Inicio de Producción</strong>.
            Asegúrese de tener los insumos listos.
        </div>
    </div>

    <!-- Resumen -->
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <div class="p-3 border rounded-3 bg-light">
                <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.7rem;">Producto</small>
                <div class="fw-bold text-dark">{{ orden.receta.producto_final.nombre }}</div>
            </div>
        </div>
        <div class="col-md-6">
             <div class="p-3 border rounded-3 bg-light">
                <small class="text-muted d-block text-uppercase fw-bold" style="font-size: 0.7rem;">Cantidad Planificada</small>
                <div class="fw-bold text-dark">{{ orden.cantidad_planificada|floatformat:0 }} {{ orden.receta.producto_final.get_unidad_produccion_display }}</div>
            </div>
        </div>
    </div>

    <h6 class="fw-bold mb-3" style="color: #5D4037; font-size: 0.9rem;">Insumos Requeridos</h6>
    <div class="table-responsive mb-3 border rounded-3">
        <table class="table table-sm mb-0">
            <thead class="bg-light">
                <tr>
                    <th class="ps-3" style="font-size: 0.8rem; color: #6F5B44;">Insumo</th>
                    <th class="text-end pe-3" style="font-size: 0.8rem; color: #6F5B44;">Cantidad Total</th>
                </tr>
            </thead>
            <tbody>
                {% for insumo in orden.receta.insumos.all %}
                <tr>
                    <td class="ps-3 py-2 small">{{ insumo.articulo.nombre }}</td>
                    <td class="text-end pe-3 py-2 small fw-bold">
                        {% widthratio insumo.cantidad 1 orden.cantidad_planificada %} {{ insumo.articulo.unidad_medida.simbolo }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <form id="iniciarOrdenForm" method="post" action="{% url 'produccion:orden_iniciar' orden.pk %}">
        {% csrf_token %}
        <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top border-light">
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal" style="font-size: 0.85rem; font-weight: 500; color: #5D4037;">Cancelar</button>
            <button type="submit" class="btn text-white" style="background: linear-gradient(135deg, #28a745 0%, #218838 100%); font-size: 0.85rem; font-weight: 500; border: none;">
                <i class="fas fa-play me-2"></i>Confirmar Inicio
            </button>
        </div>
    </form>
</div>
