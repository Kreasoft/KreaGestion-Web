<form method="post" id="usuarioFormModal" novalidate action="{% if usuario %}{% url 'usuarios:usuario_edit' usuario.id %}{% else %}{% url 'usuarios:usuario_create' %}{% endif %}">
    {% load widget_tweaks %}
    {% csrf_token %}
    
    <div class="row g-4">
        <!-- Información Básica -->
        <div class="col-md-6">
            <h6 class="text-stone-medium fw-bold text-uppercase border-bottom pb-2 mb-3">
                <i class="fas fa-user-circle me-2"></i>Información del Usuario
            </h6>
            
            <div class="mb-3">
                <label for="{{ form.username.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-id-badge text-muted me-1"></i>{{ form.username.label }} <span class="text-danger">*</span>
                </label>
                {{ form.username|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.username.id_for_label }}"></div>
                {% if form.username.help_text %}
                    <small class="form-text text-muted">{{ form.username.help_text }}</small>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.first_name.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-user text-muted me-1"></i>{{ form.first_name.label }} <span class="text-danger">*</span>
                </label>
                {{ form.first_name|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.first_name.id_for_label }}"></div>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.last_name.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-user text-muted me-1"></i>{{ form.last_name.label }} <span class="text-danger">*</span>
                </label>
                {{ form.last_name|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.last_name.id_for_label }}"></div>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-envelope text-muted me-1"></i>{{ form.email.label }} <span class="text-danger">*</span>
                </label>
                {{ form.email|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.email.id_for_label }}"></div>
            </div>
        </div>
        
        <!-- Permisos y Configuración -->
        <div class="col-md-6">
            <h6 class="text-stone-medium fw-bold text-uppercase border-bottom pb-2 mb-3">
                <i class="fas fa-cogs me-2"></i>Permisos y Configuración
            </h6>
            
            {% if not usuario %}
            <!-- Solo mostrar en creación -->
            <div class="mb-3">
                <label for="{{ form.empresa.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-building text-muted me-1"></i>{{ form.empresa.label }} <span class="text-danger">*</span>
                </label>
                {{ form.empresa|add_class:"form-select form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.empresa.id_for_label }}"></div>
            </div>
            {% endif %}
            
            <div class="mb-3">
                <label for="{{ form.grupo.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-users-cog text-muted me-1"></i>{{ form.grupo.label }}
                </label>
                {{ form.grupo|add_class:"form-select form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.grupo.id_for_label }}"></div>
                <small class="form-text text-muted">Asigna un rol al usuario para controlar sus permisos</small>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.sucursal.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    <i class="fas fa-store text-muted me-1"></i>{{ form.sucursal.label }}
                </label>
                {{ form.sucursal|add_class:"form-select form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.sucursal.id_for_label }}"></div>
                {% if form.sucursal.help_text %}
                    <small class="form-text text-muted">{{ form.sucursal.help_text }}</small>
                {% endif %}
            </div>
            
            {% if usuario %}
            <div class="mb-3 form-check custom-checkbox stone-check-container">
                {{ form.is_active|add_class:"form-check-input" }}
                <label class="form-check-label ms-2" for="{{ form.is_active.id_for_label }}">
                    {{ form.is_active.label }}
                </label>
                <div class="text-danger small mt-1" id="error_{{ form.is_active.id_for_label }}"></div>
            </div>
            {% endif %}
            
            <div class="mb-3 form-check custom-checkbox stone-check-container">
                {{ form.is_staff|add_class:"form-check-input" }}
                <label class="form-check-label ms-2" for="{{ form.is_staff.id_for_label }}">
                    {{ form.is_staff.label }}
                </label>
                <div class="text-danger small mt-1" id="error_{{ form.is_staff.id_for_label }}"></div>
                <small class="form-text text-muted d-block ms-4">Permite acceso al panel de administración de Django</small>
            </div>
            
            {% if not usuario %}
            <!-- Contraseñas solo en creación -->
            <hr class="my-4" style="border-color: #E8DCC8;">
            <h6 class="text-stone-medium fw-bold text-uppercase border-bottom pb-2 mb-3">
                <i class="fas fa-lock me-2"></i>Contraseña
            </h6>
            
            <div class="mb-3">
                <label for="{{ form.password1.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    {{ form.password1.label }} <span class="text-danger">*</span>
                </label>
                {{ form.password1|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.password1.id_for_label }}"></div>
                {% if form.password1.help_text %}
                    <small class="form-text text-muted">{{ form.password1.help_text }}</small>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.password2.id_for_label }}" class="form-label text-stone-medium fw-bold">
                    {{ form.password2.label }} <span class="text-danger">*</span>
                </label>
                {{ form.password2|add_class:"form-control form-control-stone" }}
                <div class="text-danger small mt-1" id="error_{{ form.password2.id_for_label }}"></div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="alert alert-danger mt-3" id="formErrors" style="display: none; border-radius: 8px;"></div>
    
    <!-- Botones de Acción -->
    <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-color: #D4C4A8; color: #6F5B44;">
            <i class="fas fa-times me-2"></i>Cancelar
        </button>
        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #6F5B44 0%, #5D4037 100%); border: none;">
            <i class="fas fa-save me-2"></i>{% if usuario %}Guardar Cambios{% else %}Crear Usuario{% endif %}
        </button>
    </div>
</form>


<style>
    /* Ajustes específicos para el modal que complementan stone-premium.css */
    .stone-check-container {
        border: 1px solid #E8DCC8;
        border-radius: 8px;
        padding: 10px 15px;
        background: white;
        transition: all 0.2s;
    }
    
    .stone-check-container:hover {
        border-color: #8B7355;
        background: #FAFAF8;
    }

    .stone-check-container .form-check-input:checked {
        background-color: #6F5B44;
        border-color: #6F5B44;
    }
</style>
