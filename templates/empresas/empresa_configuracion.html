{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block body_class %}hide-top-bar{% endblock %}

{% block content %}
<div class="container py-4">
	<div class="row justify-content-center">
		<div class="col-md-10">
			<div class="card shadow">
				<div class="card-header bg-success text-white">
					<h4 class="m-0">
						<i class="fas fa-cogs me-2"></i>
						Configuración de Empresa: {{ empresa.nombre }}
					</h4>
				</div>
				<div class="card-body">
					{% if form.errors %}
						<div class="alert alert-danger">
							<strong>Por favor corrija los siguientes errores:</strong>
							<ul class="mb-0">
								{% for field, errors in form.errors.items %}
									{% for error in errors %}
										<li>{{ field|title }}: {{ error }}</li>
									{% endfor %}
								{% endfor %}
							</ul>
						</div>
					{% endif %}
					
					<!-- Información de la empresa -->
					<div class="row mb-4">
						<div class="col-md-6">
							<div class="card bg-light">
								<div class="card-body">
									<h6 class="card-title text-primary">
										<i class="fas fa-building me-2"></i>Información de la Empresa
									</h6>
									<p class="card-text mb-1"><strong>Nombre:</strong> {{ empresa.nombre }}</p>
									<p class="card-text mb-1"><strong>RUT:</strong> {{ empresa.rut }}</p>
									<p class="card-text mb-1"><strong>Giro:</strong> {{ empresa.giro }}</p>
									<p class="card-text mb-0"><strong>Estado:</strong> 
										<span class="badge bg-{% if empresa.estado == 'activa' %}success{% else %}secondary{% endif %}">
											{{ empresa.get_estado_display }}
										</span>
									</p>
								</div>
							</div>
						</div>
						<div class="col-md-6">
							<div class="card bg-light">
								<div class="card-body">
									<h6 class="card-title text-primary">
										<i class="fas fa-map-marker-alt me-2"></i>Ubicación
									</h6>
									<p class="card-text mb-1"><strong>Dirección:</strong> {{ empresa.direccion }}</p>
									<p class="card-text mb-1"><strong>Comuna:</strong> {{ empresa.comuna }}</p>
									<p class="card-text mb-1"><strong>Ciudad:</strong> {{ empresa.ciudad }}</p>
									<p class="card-text mb-0"><strong>Región:</strong> {{ empresa.region }}</p>
								</div>
							</div>
						</div>
					</div>
					
					<!-- Formulario de configuración -->
					<form method="post">
						{% csrf_token %}
						{% crispy form %}
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
// Validación de prefijos
document.querySelectorAll('input[name^="prefijo"]').forEach(function(input) {
    input.addEventListener('input', function(e) {
        // Solo permitir letras y números, máximo 10 caracteres
        e.target.value = e.target.value.replace(/[^a-zA-Z0-9]/g, '').substring(0, 10);
    });
});

// Validación de números
document.querySelectorAll('input[name^="siguiente"]').forEach(function(input) {
    input.addEventListener('input', function(e) {
        // Solo permitir números positivos
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
        if (e.target.value === '') {
            e.target.value = '1';
        }
    });
});
</script>
{% endblock %}
<div class="row">
	<!-- Información General -->
	<div class="col-lg-8">
		<div class="card mb-4">
			<div class="card-header">
				<h5 class="m-0">
					<i class="fas fa-building me-2"></i>
					Información General
				</h5>
			</div>
			<div class="card-body">
				<form method="post">
					{% csrf_token %}
					
					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">Nombre de la Empresa *</label>
								<input type="text" class="form-control" name="nombre" value="{{ empresa.nombre }}" required>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">RUT *</label>
								<input type="text" class="form-control" name="rut" value="{{ empresa.rut }}" required>
							</div>
						</div>
					</div>
					
					<div class="mb-3">
						<label class="form-label">Razón Social</label>
						<input type="text" class="form-control" name="razon_social" value="{{ empresa.razon_social }}">
					</div>
					
					<div class="mb-3">
						<label class="form-label">Giro Comercial</label>
						<input type="text" class="form-control" name="giro" value="{{ empresa.giro }}">
					</div>
					
					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">Teléfono</label>
								<input type="tel" class="form-control" name="telefono" value="{{ empresa.telefono }}">
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">Email</label>
								<input type="email" class="form-control" name="email" value="{{ empresa.email }}">
							</div>
						</div>
					</div>
					
					<div class="mb-3">
						<label class="form-label">Dirección</label>
						<input type="text" class="form-control" name="direccion" value="{{ empresa.direccion }}">
					</div>
					
					<div class="row">
						<div class="col-md-4">
							<div class="mb-3">
								<label class="form-label">Comuna</label>
								<input type="text" class="form-control" name="comuna" value="{{ empresa.comuna }}">
							</div>
						</div>
						<div class="col-md-4">
							<div class="mb-3">
								<label class="form-label">Ciudad</label>
								<input type="text" class="form-control" name="ciudad" value="{{ empresa.ciudad }}">
							</div>
						</div>
						<div class="col-md-4">
							<div class="mb-3">
								<label class="form-label">Región</label>
								<input type="text" class="form-control" name="region" value="{{ empresa.region }}">
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">Estado</label>
								<select class="form-select" name="estado">
									<option value="activa" {% if empresa.estado == 'activa' %}selected{% endif %}>Activa</option>
									<option value="inactiva" {% if empresa.estado == 'inactiva' %}selected{% endif %}>Inactiva</option>
									<option value="suspendida" {% if empresa.estado == 'suspendida' %}selected{% endif %}>Suspendida</option>
								</select>
							</div>
						</div>
						<div class="col-md-6">
							<div class="mb-3">
								<label class="form-label">Régimen Tributario</label>
								<select class="form-select" name="regimen_tributario">
									<option value="19" {% if empresa.regimen_tributario == '19' %}selected{% endif %}>19% IVA</option>
									<option value="0" {% if empresa.regimen_tributario == '0' %}selected{% endif %}>0% IVA</option>
									<option value="exento" {% if empresa.regimen_tributario == 'exento' %}selected{% endif %}>Exento de IVA</option>
								</select>
							</div>
						</div>
					</div>
					
					<div class="d-flex justify-content-end">
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-save me-2"></i>Guardar Cambios
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
	<!-- Sidebar con Información -->
	<div class="col-lg-4">
		<!-- Información Actual -->
		<div class="card mb-4">
			<div class="card-header">
				<h6 class="m-0">
					<i class="fas fa-info-circle me-2"></i>
					Información Actual
				</h6>
			</div>
			<div class="card-body">
				<div class="mb-3">
					<strong>Empresa:</strong> {{ empresa.nombre }}
				</div>
				<div class="mb-3">
					<strong>RUT:</strong> {{ empresa.rut }}
				</div>
				<div class="mb-3">
					<strong>Estado:</strong>
					{% if empresa.estado == 'activa' %}
						<span class="badge bg-success">Activa</span>
					{% elif empresa.estado == 'inactiva' %}
						<span class="badge bg-danger">Inactiva</span>
					{% else %}
						<span class="badge bg-warning">Suspendida</span>
					{% endif %}
				</div>
				<div class="mb-3">
					<strong>Régimen:</strong> {{ empresa.regimen_tributario }}%
				</div>
				<div class="mb-3">
					<strong>Sucursales:</strong> {{ empresa.sucursales.count }}
				</div>
			</div>
		</div>
		
		<!-- Configuraciones Adicionales -->
		<div class="card mb-4">
			<div class="card-header">
				<h6 class="m-0">
					<i class="fas fa-cog me-2"></i>
					Configuraciones Adicionales
				</h6>
			</div>
			<div class="card-body">
				<div class="d-grid gap-2">
					<a href="#" class="btn btn-outline-primary btn-sm">
						<i class="fas fa-file-invoice me-2"></i>Configurar Documentos
					</a>
					<a href="#" class="btn btn-outline-info btn-sm">
						<i class="fas fa-chart-bar me-2"></i>Configurar Reportes
					</a>
					<a href="#" class="btn btn-outline-warning btn-sm">
						<i class="fas fa-bell me-2"></i>Configurar Alertas
					</a>
					<a href="#" class="btn btn-outline-secondary btn-sm">
						<i class="fas fa-users me-2"></i>Gestionar Usuarios
					</a>
				</div>
			</div>
		</div>
		
		<!-- Información de Auditoría -->
		<div class="card">
			<div class="card-header">
				<h6 class="m-0">
					<i class="fas fa-history me-2"></i>
					Información de Auditoría
				</h6>
			</div>
			<div class="card-body">
				<div class="mb-2">
					<strong>Creado:</strong> {{ empresa.fecha_creacion|date:"d/m/Y H:i" }}
				</div>
				<div class="mb-2">
					<strong>Última modificación:</strong> {{ empresa.fecha_modificacion|date:"d/m/Y H:i" }}
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}
