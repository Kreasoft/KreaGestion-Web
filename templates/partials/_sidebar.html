{% load static %}
<div class="sidebar-header">
    <div class="d-flex justify-content-between align-items-center">
        <div class="logo-container">
            <a href="/">
                <img src="{% static 'image/logo.png' %}?v=2" alt="GestionCloud" class="logo-img">
            </a>
        </div>
        <button class="toggle-sidebar-mobile d-lg-none" id="toggleSidebarMobile">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</div>

<div class="sidebar-nav">
    <!-- Dashboard -->
    <div class="nav-item">
        <a href="/" class="nav-link {% if request.resolver_match.url_name == 'dashboard' or request.path == '/' %}active{% endif %}">
            <i class="nav-icon fas fa-tachometer-alt"></i>
            <span class="nav-text">Dashboard</span>
        </a>
    </div>
    
    <!-- Submenú de Artículos -->
    {% if perms.articulos.view_articulo or perms.articulos.view_categoriaarticulo or perms.articulos.view_impuestoespecifico or perms.articulos.view_unidadmedida or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#articulosSubmenu" aria-expanded="{% if request.resolver_match.url_name == 'articulo_list' or request.resolver_match.url_name == 'categoria_list' or request.resolver_match.url_name == 'lista_precio_list' or request.resolver_match.url_name == 'lista_precio_create' or request.resolver_match.url_name == 'lista_precio_detail' or request.resolver_match.url_name == 'lista_precio_update' or 'kit_oferta' in request.resolver_match.url_name or request.resolver_match.url_name == 'unidad_medida_list' or request.resolver_match.url_name == 'impuesto_especifico_list' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-box"></i>
            <span class="nav-text">Artículos</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.url_name == 'articulo_list' or request.resolver_match.url_name == 'categoria_list' or request.resolver_match.url_name == 'lista_precio_list' or request.resolver_match.url_name == 'lista_precio_create' or request.resolver_match.url_name == 'lista_precio_detail' or request.resolver_match.url_name == 'lista_precio_update' or 'kit_oferta' in request.resolver_match.url_name or request.resolver_match.url_name == 'unidad_medida_list' or request.resolver_match.url_name == 'impuesto_especifico_list' %}show{% endif %}" id="articulosSubmenu">
            <div class="submenu-items">
                <!-- Gestión Principal -->
                {% if perms.articulos.view_articulo or user.is_superuser %}
                <a href="{% url 'articulos:articulo_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'articulo_list' %}active{% endif %}">
                    <i class="fas fa-list me-2" style="color: #8B7355;"></i>
                    <span>Lista de Artículos</span>
                </a>
                {% endif %}
                
                <!-- Configuración -->
                <div class="submenu-separator"></div>
                {% if perms.articulos.view_categoriaarticulo or user.is_superuser %}
                <a href="{% url 'articulos:categoria_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'categoria_list' %}active{% endif %}">
                    <i class="fas fa-tags me-2" style="color: #A0826D;"></i>
                    <span>Categorías</span>
                </a>
                {% endif %}
                {% if perms.articulos.view_listaprecio or user.is_superuser %}
                <a href="{% url 'articulos:lista_precio_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'lista_precio_list' or request.resolver_match.url_name == 'lista_precio_create' or request.resolver_match.url_name == 'lista_precio_detail' or request.resolver_match.url_name == 'lista_precio_update' %}active{% endif %}">
                    <i class="fas fa-dollar-sign me-2" style="color: #D4A574;"></i>
                    <span>Listas de Precios</span>
                </a>
                {% endif %}
                {% if perms.articulos.view_articulo or user.is_superuser %}
                <a href="{% url 'articulos:kit_oferta_list' %}" class="nav-link submenu-link {% if 'kit_oferta' in request.resolver_match.url_name %}active{% endif %}">
                    <i class="fas fa-gift me-2" style="color: #C8A882;"></i>
                    <span>Kits de Ofertas</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_precioclientearticulo or user.is_superuser %}
                <a id="link-precios-especiales" href="{% url 'ventas:precio_cliente_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'precio_cliente_list' %}active{% endif %}">
                    <i class="fas fa-user-tag me-2" style="color: #C8A882;"></i>
                    <span>Precios Especiales Clientes</span>
                </a>
                {% endif %}
                {% if perms.articulos.view_unidadmedida or user.is_superuser %}
                <a href="{% url 'articulos:unidad_medida_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'unidad_medida_list' %}active{% endif %}">
                    <i class="fas fa-ruler me-2" style="color: #B8956A;"></i>
                    <span>Unidades de Medida</span>
                </a>
                {% endif %}
                {% if perms.articulos.view_impuestoespecifico or user.is_superuser %}
                <a href="{% url 'articulos:impuesto_especifico_list' %}" class="nav-link submenu-link {% if request.resolver_match.url_name == 'impuesto_especifico_list' %}active{% endif %}">
                    <i class="fas fa-percentage me-2" style="color: #C19461;"></i>
                    <span>Impuestos Específicos</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Ventas -->
    {% if perms.ventas.view_venta or perms.ventas.view_cotizacion or perms.ventas.view_vendedor or perms.ventas.view_formapago or perms.ventas.view_estaciontrabajo or perms.clientes.view_cliente or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#ventasSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'ventas' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-cash-register"></i>
            <span class="nav-text">Ventas</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'ventas' %}show{% endif %}" id="ventasSubmenu">
            <div class="submenu-items">
                <!-- Operaciones -->
                {% if perms.ventas.add_venta or user.is_superuser %}
                <a href="{% url 'ventas:pos_view' %}" class="nav-link submenu-link {% if 'pos' in request.path %}active{% endif %}">
                    <i class="fas fa-shopping-cart me-2" style="color: #8B7355;"></i>
                    <span>Punto de Venta (POS)</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_cotizacion or user.is_superuser %}
                <a href="{% url 'ventas:cotizacion_list' %}" class="nav-link submenu-link {% if 'cotizaciones' in request.path %}active{% endif %}">
                    <i class="fas fa-file-invoice me-2" style="color: #8B7355;"></i>
                    <span>Cotizaciones</span>
                </a>
                {% endif %}
                
                <!-- Consultas -->
                <div class="submenu-separator"></div>
                {% if perms.ventas.view_venta or user.is_superuser %}
                <a href="{% url 'ventas:ticket_list' %}" class="nav-link submenu-link {% if 'tickets' in request.path %}active{% endif %}">
                    <i class="fas fa-receipt me-2" style="color: #A0826D;"></i>
                    <span>Lista de Tickets</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_venta or user.is_superuser %}
                <a href="{% url 'ventas:libro_ventas' %}" class="nav-link submenu-link {% if 'libro-ventas' in request.path %}active{% endif %}">
                    <i class="fas fa-book me-2" style="color: #A0826D;"></i>
                    <span>Libro de Ventas</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_notacredito or user.is_superuser %}
                <a href="{% url 'ventas:notacredito_list' %}" class="nav-link submenu-link {% if 'notas-credito' in request.path %}active{% endif %}">
                    <i class="fas fa-file-excel me-2" style="color: #A0826D;"></i>
                    <span>Notas de Crédito</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_notadebito or user.is_superuser %}
                <a href="{% url 'ventas:notadebito_list' %}" class="nav-link submenu-link {% if 'notas-debito' in request.path %}active{% endif %}">
                    <i class="fas fa-file-invoice-dollar me-2" style="color: #A0826D;"></i>
                    <span>Notas de Débito</span>
                </a>
                {% endif %}
                
                <!-- Configuración -->
                <div class="submenu-separator"></div>
                {% if perms.clientes.view_cliente or user.is_superuser %}
                <a href="{% url 'clientes:cliente_list' %}" class="nav-link submenu-link {% if request.resolver_match.app_name == 'clientes' %}active{% endif %}">
                    <i class="fas fa-user-friends me-2" style="color: #D4A574;"></i>
                    <span>Clientes</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_vendedor or user.is_superuser %}
                <a href="{% url 'ventas:vendedor_list' %}" class="nav-link submenu-link {% if 'vendedor' in request.path %}active{% endif %}">
                    <i class="fas fa-users me-2" style="color: #D4A574;"></i>
                    <span>Vendedores</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_formapago or user.is_superuser %}
                <a href="{% url 'ventas:formapago_list' %}" class="nav-link submenu-link {% if 'formas-pago' in request.path %}active{% endif %}">
                    <i class="fas fa-credit-card me-2" style="color: #D4A574;"></i>
                    <span>Formas de Pago</span>
                </a>
                {% endif %}
                {% if perms.ventas.view_estaciontrabajo or user.is_superuser %}
                <a href="{% url 'ventas:estaciontrabajo_list' %}" class="nav-link submenu-link {% if 'estaciones-trabajo' in request.path %}active{% endif %}">
                    <i class="fas fa-desktop me-2" style="color: #D4A574;"></i>
                    <span>Estaciones de Trabajo</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Pedidos -->
    {% if perms.pedidos.view_ordenpedido or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#pedidosSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'pedidos' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-clipboard-list"></i>
            <span class="nav-text">Pedidos</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'pedidos' %}show{% endif %}" id="pedidosSubmenu">
            <div class="submenu-items">
                {% if perms.pedidos.view_ordenpedido or user.is_superuser %}
                <a href="{% url 'pedidos:orden_pedido_list' %}" class="nav-link submenu-link {% if 'pedidos' in request.path and 'despachos' not in request.path and 'vehiculos' not in request.path and 'choferes' not in request.path %}active{% endif %}">
                    <i class="fas fa-file-alt me-2" style="color: #8B7355;"></i>
                    <span>Órdenes de Pedido</span>
                </a>
                {% endif %}
                {% if perms.pedidos.view_ordendespacho or user.is_superuser %}
                <a href="{% url 'pedidos:orden_despacho_list' %}" class="nav-link submenu-link {% if 'despachos' in request.path %}active{% endif %}">
                    <i class="fas fa-truck me-2" style="color: #A0826D;"></i>
                    <span>Órdenes de Despacho</span>
                </a>
                {% endif %}
                
                <div class="submenu-separator"></div>
                {% if perms.pedidos.view_vehiculo or user.is_superuser %}
                <a href="{% url 'pedidos:vehiculo_list' %}" class="nav-link submenu-link {% if 'vehiculos' in request.path %}active{% endif %}">
                    <i class="fas fa-truck-moving me-2" style="color: #D4A574;"></i>
                    <span>Vehículos</span>
                </a>
                {% endif %}
                {% if perms.pedidos.view_chofer or user.is_superuser %}
                <a href="{% url 'pedidos:chofer_list' %}" class="nav-link submenu-link {% if 'choferes' in request.path %}active{% endif %}">
                    <i class="fas fa-user-tie me-2" style="color: #D4A574;"></i>
                    <span>Choferes</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Compras -->
    {% if perms.compras.view_ordencompra or perms.proveedores.view_proveedor or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#comprasSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'compras' or request.resolver_match.app_name == 'proveedores' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-shopping-bag"></i>
            <span class="nav-text">Compras</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'compras' or request.resolver_match.app_name == 'proveedores' %}show{% endif %}" id="comprasSubmenu">
            <div class="submenu-items">
                {% if perms.compras.view_ordencompra or user.is_superuser %}
                <a href="{% url 'compras:orden_compra_list' %}" class="nav-link submenu-link {% if 'compras' in request.path %}active{% endif %}">
                    <i class="fas fa-file-invoice me-2" style="color: #8B7355;"></i>
                    <span>Órdenes de Compra</span>
                </a>
                {% endif %}
                
                <div class="submenu-separator"></div>
                {% if perms.proveedores.view_proveedor or user.is_superuser %}
                <a href="{% url 'proveedores:proveedor_list' %}" class="nav-link submenu-link {% if request.resolver_match.app_name == 'proveedores' %}active{% endif %}">
                    <i class="fas fa-truck-loading me-2" style="color: #D4A574;"></i>
                    <span>Proveedores</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Inventario -->
    {% if perms.inventario.view_movimientoinventario or perms.inventario.view_ajusteinventario or perms.inventario.view_trasladoinventario or perms.bodegas.view_bodega or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#inventarioSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'inventario' or request.resolver_match.app_name == 'bodegas' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-warehouse"></i>
            <span class="nav-text">Inventario</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'inventario' or request.resolver_match.app_name == 'bodegas' %}show{% endif %}" id="inventarioSubmenu">
            <div class="submenu-items">
                {% if perms.inventario.view_movimientoinventario or user.is_superuser %}
                <a href="{% url 'inventario:dashboard' %}" class="nav-link submenu-link {% if 'inventario/dashboard' in request.path %}active{% endif %}">
                    <i class="fas fa-chart-line me-2" style="color: #8B7355;"></i>
                    <span>Dashboard Inventario</span>
                </a>
                {% endif %}
                {% if perms.inventario.view_movimientoinventario or user.is_superuser %}
                <a href="{% url 'inventario:inventario_list' %}" class="nav-link submenu-link {% if 'movimientos' in request.path %}active{% endif %}">
                    <i class="fas fa-exchange-alt me-2" style="color: #8B7355;"></i>
                    <span>Movimientos</span>
                </a>
                {% endif %}
                {% if perms.inventario.view_ajusteinventario or user.is_superuser %}
                <a href="{% url 'inventario:ajustes_list' %}" class="nav-link submenu-link {% if 'ajustes' in request.path %}active{% endif %}">
                    <i class="fas fa-sliders-h me-2" style="color: #A0826D;"></i>
                    <span>Ajustes</span>
                </a>
                {% endif %}
                {% if perms.inventario.view_trasladoinventario or user.is_superuser %}
                <a href="{% url 'inventario:transferencia_list' %}" class="nav-link submenu-link {% if 'transferencias' in request.path or 'traslados' in request.path %}active{% endif %}">
                    <i class="fas fa-dolly me-2" style="color: #A0826D;"></i>
                    <span>Transferencias</span>
                </a>
                {% endif %}
                
                <div class="submenu-separator"></div>
                {% if perms.bodegas.view_bodega or user.is_superuser %}
                <a href="{% url 'bodegas:bodega_list' %}" class="nav-link submenu-link {% if request.resolver_match.app_name == 'bodegas' %}active{% endif %}">
                    <i class="fas fa-building me-2" style="color: #D4A574;"></i>
                    <span>Bodegas</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Producción -->
    {% if perms.produccion.view_ordenproduccion or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#produccionSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'produccion' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-industry"></i>
            <span class="nav-text">Producción</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'produccion' %}show{% endif %}" id="produccionSubmenu">
            <div class="submenu-items">
                {% if perms.produccion.view_ordenproduccion or user.is_superuser %}
                <a href="{% url 'produccion:orden_list' %}" class="nav-link submenu-link {% if 'produccion' in request.path %}active{% endif %}">
                    <i class="fas fa-cogs me-2" style="color: #8B7355;"></i>
                    <span>Órdenes de Producción</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Facturación Electrónica -->
    {% if perms.facturacion_electronica.view_dte or perms.facturacion_electronica.view_caf or perms.documentos.view_tipodocumento or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#feSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'facturacion_electronica' or request.resolver_match.app_name == 'documentos' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-file-invoice-dollar"></i>
            <span class="nav-text">Facturación Electrónica</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'facturacion_electronica' or request.resolver_match.app_name == 'documentos' %}show{% endif %}" id="feSubmenu">
            <div class="submenu-items">
                {% if perms.facturacion_electronica.view_dte or user.is_superuser %}
                <a href="{% url 'facturacion_electronica:dte_list' %}" class="nav-link submenu-link {% if 'dte' in request.path and 'dashboard' not in request.path %}active{% endif %}">
                    <i class="fas fa-file-alt me-2" style="color: #8B7355;"></i>
                    <span>Documentos Tributarios</span>
                </a>
                {% endif %}
                {% if perms.facturacion_electronica.view_dte or user.is_superuser %}
                <a href="{% url 'facturacion_electronica:dashboard' %}" class="nav-link submenu-link {% if 'dashboard' in request.path and 'facturacion' in request.path %}active{% endif %}">
                    <i class="fas fa-tachometer-alt me-2" style="color: #8B7355;"></i>
                    <span>Dashboard FE</span>
                </a>
                {% endif %}
                
                <div class="submenu-separator"></div>
                {% if perms.facturacion_electronica.view_caf or user.is_superuser %}
                <a href="{% url 'facturacion_electronica:caf_list' %}" class="nav-link submenu-link {% if 'caf' in request.path %}active{% endif %}">
                    <i class="fas fa-key me-2" style="color: #D4A574;"></i>
                    <span>Folios CAF</span>
                </a>
                {% endif %}
                {% if perms.documentos.view_tipodocumento or user.is_superuser %}
                <a href="{% url 'documentos:tipodocumento_list' %}" class="nav-link submenu-link {% if 'documentos' in request.path %}active{% endif %}">
                    <i class="fas fa-file-contract me-2" style="color: #D4A574;"></i>
                    <span>Tipos de Documento</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Caja -->
    {% if perms.caja.view_aperturacaja or perms.caja.view_caja or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#cajaSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'caja' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-cash-register"></i>
            <span class="nav-text">Caja</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'caja' %}show{% endif %}" id="cajaSubmenu">
            <div class="submenu-items">
                {% if perms.caja.view_aperturacaja or user.is_superuser %}
                <a href="{% url 'caja:apertura_list' %}" class="nav-link submenu-link {% if 'apertura' in request.path %}active{% endif %}">
                    <i class="fas fa-cash-register me-2" style="color: #8B7355;"></i>
                    <span>Aperturas de Caja</span>
                </a>
                {% endif %}
                {% if perms.caja.view_caja or user.is_superuser %}
                <a href="{% url 'caja:caja_list' %}" class="nav-link submenu-link {% if 'cajas' in request.path and 'aperturas' not in request.path %}active{% endif %}">
                    <i class="fas fa-wallet me-2" style="color: #A0826D;"></i>
                    <span>Gestión de Cajas</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Tesorería -->
    {% if perms.tesoreria.view_documentopendienteproveedor or perms.tesoreria.view_documentopendientecliente or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#tesoreriaSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'tesoreria' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-university"></i>
            <span class="nav-text">Tesorería</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'tesoreria' %}show{% endif %}" id="tesoreriaSubmenu">
            <div class="submenu-items">
                {% if perms.tesoreria.view_documentopendienteproveedor or user.is_superuser %}
                <a href="{% url 'tesoreria:cuenta_corriente_proveedor_list' %}" class="nav-link submenu-link {% if 'proveedor' in request.path %}active{% endif %}">
                    <i class="fas fa-file-invoice-dollar me-2" style="color: #8B7355;"></i>
                    <span>Cuentas por Pagar</span>
                </a>
                {% endif %}
                {% if perms.tesoreria.view_documentopendientecliente or user.is_superuser %}
                <a href="{% url 'tesoreria:cuenta_corriente_cliente_list' %}" class="nav-link submenu-link {% if 'cliente' in request.path and 'tesoreria' in request.path %}active{% endif %}">
                    <i class="fas fa-file-invoice me-2" style="color: #A0826D;"></i>
                    <span>Cuentas por Cobrar</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Informes -->
    {% if user.is_superuser or user.is_staff %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#informesSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'informes' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-chart-bar"></i>
            <span class="nav-text">Informes</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'informes' %}show{% endif %}" id="informesSubmenu">
            <div class="submenu-items">
                <a href="{% url 'informes:dashboard' %}" class="nav-link submenu-link {% if 'informes' in request.path and 'dashboard' in request.path %}active{% endif %}">
                    <i class="fas fa-tachometer-alt me-2" style="color: #8B7355;"></i>
                    <span>Dashboard Informes</span>
                </a>
                <a href="{% url 'informes:ventas_periodo' %}" class="nav-link submenu-link {% if 'ventas/periodo' in request.path %}active{% endif %}">
                    <i class="fas fa-chart-line me-2" style="color: #8B7355;"></i>
                    <span>Ventas por Período</span>
                </a>
                <a href="{% url 'informes:stock_actual' %}" class="nav-link submenu-link {% if 'stock' in request.path and 'informes' in request.path %}active{% endif %}">
                    <i class="fas fa-boxes me-2" style="color: #A0826D;"></i>
                    <span>Stock Actual</span>
                </a>
                <a href="{% url 'informes:compras_periodo' %}" class="nav-link submenu-link {% if 'compras/periodo' in request.path %}active{% endif %}">
                    <i class="fas fa-shopping-bag me-2" style="color: #A0826D;"></i>
                    <span>Compras por Período</span>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Submenú de Configuración -->
    {% if perms.empresas.view_empresa or user.is_superuser %}
    <div class="nav-item has-submenu">
        <a href="#" class="nav-link submenu-toggle" data-bs-toggle="collapse" data-bs-target="#configuracionSubmenu" aria-expanded="{% if request.resolver_match.app_name == 'empresas' or request.resolver_match.app_name == 'usuarios' or request.resolver_match.app_name == 'utilidades' %}true{% else %}false{% endif %}">
            <i class="nav-icon fas fa-cog"></i>
            <span class="nav-text">Configuración</span>
            <i class="fas fa-chevron-down submenu-arrow"></i>
        </a>
        <div class="collapse submenu {% if request.resolver_match.app_name == 'empresas' or request.resolver_match.app_name == 'usuarios' or request.resolver_match.app_name == 'utilidades' %}show{% endif %}" id="configuracionSubmenu">
            <div class="submenu-items">
                {% if perms.empresas.view_empresa or user.is_superuser %}
                <a href="{% url 'empresas:empresa_list' %}" class="nav-link submenu-link {% if 'empresas/lista' in request.path %}active{% endif %}">
                    <i class="fas fa-building me-2" style="color: #8B7355;"></i>
                    <span>Empresas</span>
                </a>
                {% endif %}
                {% if perms.empresas.view_sucursal or user.is_superuser %}
                <a href="{% url 'empresas:sucursal_list' %}" class="nav-link submenu-link {% if 'sucursales' in request.path %}active{% endif %}">
                    <i class="fas fa-store me-2" style="color: #8B7355;"></i>
                    <span>Sucursales</span>
                </a>
                {% endif %}
                
                <div class="submenu-separator"></div>
                {% if user.is_superuser %}
                <a href="{% url 'usuarios:usuario_list' %}" class="nav-link submenu-link {% if 'usuarios' in request.path %}active{% endif %}">
                    <i class="fas fa-users-cog me-2" style="color: #D4A574;"></i>
                    <span>Usuarios</span>
                </a>
                {% endif %}
                {% if user.is_superuser %}
                <a href="{% url 'utilidades:dashboard' %}" class="nav-link submenu-link {% if 'utilidades' in request.path %}active{% endif %}">
                    <i class="fas fa-tools me-2" style="color: #D4A574;"></i>
                    <span>Utilidades del Sistema</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .sidebar-nav {
        padding: 1rem 0;
    }
    
    .nav-item {
        margin-bottom: 0.25rem;
    }
    
    .nav-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        color: #495057;
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
        position: relative;
    }
    
    .nav-link:hover, .nav-link.active {
        color: #212529;
        background-color: #F8F9FA;
        border-left-color: #CD853F;
    }
    
    .nav-icon {
        width: 20px;
        margin-right: 1rem;
        text-align: center;
        font-size: 1.1rem;
        color: #CD853F;
    }
    
    .nav-text {
        flex: 1;
        font-weight: 500;
    }
    
    .submenu-arrow {
        font-size: 0.8rem;
        transition: transform 0.3s ease;
        color: #6c757d;
    }
    
    .submenu-toggle[aria-expanded="true"] .submenu-arrow {
        transform: rotate(180deg);
    }
    
    .submenu {
        background-color: #F8F9FA;
    }
    
    .submenu-items {
        padding: 0.5rem 0;
    }
    
    .submenu-link {
        padding: 0.5rem 1.5rem 0.5rem 3.5rem !important;
        font-size: 0.9rem;
        color: #6c757d !important;
        border-left: 3px solid transparent;
    }
    
    .submenu-link:hover, .submenu-link.active {
        color: #212529 !important;
        background-color: #E9ECEF;
        border-left-color: #CD853F;
    }
    
    .submenu-separator {
        height: 1px;
        background-color: #DEE2E6;
        margin: 0.5rem 1.5rem 0.5rem 3.5rem;
    }
    
    .sidebar.collapsed .submenu-arrow {
        display: none;
    }
    
    .sidebar.collapsed .has-submenu .submenu {
        display: none !important;
    }
    
    /* Responsive */
    @media (max-width: 991px) {
        .submenu-link {
            padding-left: 2.5rem !important;
        }
        
        .submenu-separator {
            margin-left: 2.5rem;
        }
    }
</style>