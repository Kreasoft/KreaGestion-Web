{% extends "base.html" %}
{% load static %}

{% block body_class %}show-top-bar{% endblock %}
{% block title %}Dashboard - GestionCloud{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header del Dashboard -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0 text-gray-800">
                        <i class="fas fa-tachometer-alt" style="color: #1E40AF;"></i>
                        Dashboard Principal
                    </h1>
                    <p class="text-muted">Bienvenido al sistema de gestión empresarial</p>
                </div>
                <div class="text-end">
                    <small class="text-muted">Última actualización: {{ "now"|date:"d/m/Y H:i" }}</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjetas de Estadísticas Principales -->
    <div class="row mb-4">
        <!-- Total Artículos -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%); border: none; box-shadow: 0 4px 15px rgba(46, 139, 87, 0.3); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title" style="color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Total Artículos</h6>
                            <h3 class="mb-0" style="color: white; font-weight: 700; font-size: 2rem;">{{ total_articulos }}</h3>
                            <small style="color: rgba(255, 255, 255, 0.7); font-size: 0.75rem;">En catálogo</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-box fa-2x" style="color: rgba(255, 255, 255, 0.6);"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ventas del Mes -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); border: none; box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title" style="color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Ventas del Mes</h6>
                            <h3 class="mb-0" style="color: white; font-weight: 700; font-size: 2rem;">${{ ventas_mes|floatformat:0 }}</h3>
                            <small style="color: rgba(255, 255, 255, 0.7); font-size: 0.75rem;">+12% vs mes anterior</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-chart-line fa-2x" style="color: rgba(255, 255, 255, 0.6);"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clientes Activos -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%); border: none; box-shadow: 0 4px 15px rgba(218, 165, 32, 0.3); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title" style="color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Clientes Activos</h6>
                            <h3 class="mb-0" style="color: white; font-weight: 700; font-size: 2rem;">{{ total_clientes }}</h3>
                            <small style="color: rgba(255, 255, 255, 0.7); font-size: 0.75rem;">+{{ clientes_nuevos_mes }} nuevos este mes</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x" style="color: rgba(255, 255, 255, 0.6);"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stock Bajo -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card text-white" style="background: linear-gradient(135deg, #CD853F 0%, #DEB887 100%); border: none; box-shadow: 0 4px 15px rgba(205, 133, 63, 0.3); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h6 class="card-title" style="color: rgba(255, 255, 255, 0.8); font-size: 0.875rem; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">Stock Bajo</h6>
                            <h3 class="mb-0" style="color: white; font-weight: 700; font-size: 2rem;">{{ stock_bajo }}</h3>
                            <small style="color: rgba(255, 255, 255, 0.7); font-size: 0.75rem;">Requieren reposición</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-exclamation-triangle fa-2x" style="color: rgba(255, 255, 255, 0.6);"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos y Tablas -->
    <div class="row">
        <!-- Gráfico de Ventas -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4" style="border-left: 4px solid #8B7355;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #F5F1E8 0%, #E8DCC8 100%);">
                    <h6 class="m-0 font-weight-bold" style="color: #6F5B44;">
                        <i class="fas fa-chart-area me-2"></i>Ventas Últimos 6 Meses
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="height: 300px;">
                        <canvas id="ventasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico de Categorías -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4" style="border-left: 4px solid #A0826D;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #F5F1E8 0%, #E8DCC8 100%);">
                    <h6 class="m-0 font-weight-bold" style="color: #6F5B44;">
                        <i class="fas fa-chart-pie me-2"></i>Ventas por Categoría
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="height: 300px;">
                        <canvas id="categoriasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Segunda fila de gráficos -->
    <div class="row">
        <!-- Productos Más Vendidos -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4" style="border-left: 4px solid #D4A574;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #F5F1E8 0%, #E8DCC8 100%);">
                    <h6 class="m-0 font-weight-bold" style="color: #6F5B44;">
                        <i class="fas fa-trophy me-2"></i>Top 5 Productos Más Vendidos
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="height: 300px;">
                        <canvas id="productosChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado del Stock -->
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4" style="border-left: 4px solid #B8956A;">
                <div class="card-header py-3" style="background: linear-gradient(135deg, #F5F1E8 0%, #E8DCC8 100%);">
                    <h6 class="m-0 font-weight-bold" style="color: #6F5B44;">
                        <i class="fas fa-boxes me-2"></i>Estado del Stock
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="height: 300px;">
                        <canvas id="stockChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Accesos Rápidos -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold" style="color: #1E40AF;">
                        <i class="fas fa-bolt me-2"></i>Accesos Rápidos
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'articulos:articulo_list' %}" class="btn btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="border: 2px solid #1E40AF; color: #1E40AF; background: transparent; transition: all 0.3s ease;" onmouseover="this.style.backgroundColor='#1E40AF'; this.style.color='white';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#1E40AF';">
                                <i class="fas fa-box fa-2x mb-2"></i>
                                <span>Artículos</span>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'ventas:pos_seleccion' %}" class="btn btn-outline-success btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                <i class="fas fa-cash-register fa-2x mb-2"></i>
                                <span>Ir al POS</span>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="#" class="btn btn-outline-info btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                <i class="fas fa-users fa-2x mb-2"></i>
                                <span>Clientes</span>
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="#" class="btn btn-outline-warning btn-lg w-100 h-100 d-flex flex-column align-items-center justify-content-center">
                                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                                <span>Reportes</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts para gráficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ ventas_series_labels|json_script:"ventas-labels" }}
{{ ventas_series_data|json_script:"ventas-data" }}
<script>
// Paleta de colores terrosa
const paletaTerrosa = {
    primary: '#8B7355',
    secondary: '#A0826D',
    tertiary: '#D4A574',
    quaternary: '#B8956A',
    quinary: '#C19461',
    senary: '#6F5B44'
};

// Gráfico de ventas (Línea)
const labels = JSON.parse(document.getElementById('ventas-labels').textContent);
const dataSeries = JSON.parse(document.getElementById('ventas-data').textContent);
const ctx1 = document.getElementById('ventasChart').getContext('2d');
const ventasChart = new Chart(ctx1, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Ventas ($)',
            data: dataSeries,
            borderColor: paletaTerrosa.primary,
            backgroundColor: 'rgba(139, 115, 85, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: paletaTerrosa.primary,
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5,
            pointHoverRadius: 7
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: true, labels: { color: paletaTerrosa.senary, font: { size: 12 } } },
            tooltip: {
                backgroundColor: paletaTerrosa.senary,
                titleColor: '#fff',
                bodyColor: '#fff',
                borderColor: paletaTerrosa.primary,
                borderWidth: 1
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(139, 115, 85, 0.1)' },
                ticks: { color: paletaTerrosa.senary }
            },
            x: {
                grid: { color: 'rgba(139, 115, 85, 0.1)' },
                ticks: { color: paletaTerrosa.senary }
            }
        }
    }
});

// Gráfico de categorías (Dona)
const ctx2 = document.getElementById('categoriasChart').getContext('2d');
const categoriasChart = new Chart(ctx2, {
    type: 'doughnut',
    data: {
        labels: ['Electrónica', 'Ropa', 'Alimentos', 'Hogar', 'Otros'],
        datasets: [{
            data: [30, 25, 20, 15, 10],
            backgroundColor: [
                paletaTerrosa.primary,
                paletaTerrosa.secondary,
                paletaTerrosa.tertiary,
                paletaTerrosa.quaternary,
                paletaTerrosa.quinary
            ],
            borderColor: '#fff',
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: { color: paletaTerrosa.senary, padding: 15, font: { size: 11 } }
            },
            tooltip: {
                backgroundColor: paletaTerrosa.senary,
                titleColor: '#fff',
                bodyColor: '#fff'
            }
        }
    }
});

// Gráfico de productos más vendidos (Barra horizontal)
const ctx3 = document.getElementById('productosChart').getContext('2d');
const productosChart = new Chart(ctx3, {
    type: 'bar',
    data: {
        labels: ['Producto A', 'Producto B', 'Producto C', 'Producto D', 'Producto E'],
        datasets: [{
            label: 'Unidades Vendidas',
            data: [150, 120, 95, 80, 65],
            backgroundColor: [
                paletaTerrosa.primary,
                paletaTerrosa.secondary,
                paletaTerrosa.tertiary,
                paletaTerrosa.quaternary,
                paletaTerrosa.quinary
            ],
            borderColor: paletaTerrosa.senary,
            borderWidth: 1
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: paletaTerrosa.senary,
                titleColor: '#fff',
                bodyColor: '#fff'
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                grid: { color: 'rgba(139, 115, 85, 0.1)' },
                ticks: { color: paletaTerrosa.senary }
            },
            y: {
                grid: { display: false },
                ticks: { color: paletaTerrosa.senary }
            }
        }
    }
});

// Gráfico de estado del stock (Barra)
const ctx4 = document.getElementById('stockChart').getContext('2d');
const stockChart = new Chart(ctx4, {
    type: 'bar',
    data: {
        labels: ['Stock Normal', 'Stock Bajo', 'Sin Stock', 'Sobre Stock'],
        datasets: [{
            label: 'Cantidad de Productos',
            data: [{{ stock_normal|default:0 }}, {{ stock_bajo|default:0 }}, {{ stock_sin|default:0 }}, {{ stock_sobre|default:0 }}],
            backgroundColor: [
                paletaTerrosa.tertiary,
                paletaTerrosa.quaternary,
                paletaTerrosa.quinary,
                paletaTerrosa.secondary
            ],
            borderColor: paletaTerrosa.senary,
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: paletaTerrosa.senary,
                titleColor: '#fff',
                bodyColor: '#fff'
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: { color: 'rgba(139, 115, 85, 0.1)' },
                ticks: { color: paletaTerrosa.senary }
            },
            x: {
                grid: { display: false },
                ticks: { color: paletaTerrosa.senary }
            }
        }
    }
});
</script>
{% endblock %}












