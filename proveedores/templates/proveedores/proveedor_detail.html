{% extends "base.html" %}
{% load static %}
{% load format_filters %}

{% block title %}Detalle del Proveedor - GestionCloud{% endblock %}

{% block body_class %}hide-top-bar{% endblock %}

{% block extra_css %}
<style>
    /* VARIABLES ESTILO PIEDRA */
    :root {
        --stone-primary: #8B7355;
        --stone-secondary: #6F5B44;
        --stone-light: #E8DCC8;
        --stone-bg: #FAFAF8;
        --stone-gradient: linear-gradient(135deg, #efebe9 0%, #d7ccc8 100%);
        --stone-text: #5D4037;
    }

    body {
        background-color: var(--stone-bg);
        color: var(--stone-text);
        font-family: 'Poppins', sans-serif;
    }

    /* CARD PRINCIPAL */
    .single-card-container {
        background: white;
        border: 1px solid var(--stone-light);
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(139, 115, 85, 0.08);
        overflow: hidden;
        max-width: 1200px;
        margin: 1.5rem auto;
    }

    /* HEADER PREMIUM */
    .stone-header-premium {
        background: var(--stone-gradient);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--stone-light);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .header-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .header-icon-box {
        width: 48px;
        height: 48px; 
        background: rgba(255, 255, 255, 0.8); 
        backdrop-filter: blur(4px);
        border-radius: 12px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        box-shadow: 0 4px 12px rgba(139, 115, 85, 0.15);
        color: var(--stone-secondary);
        font-size: 1.25rem;
    }

    .header-text h1 {
        color: var(--stone-text);
        font-size: 1.35rem;
        margin: 0;
        letter-spacing: -0.5px;
        line-height: 1.1;
    }
    
    .header-text p {
        color: #795548;
        font-size: 0.85rem;
        margin: 0;
        font-weight: 500;
        opacity: 0.9;
    }

    .header-btn {
        padding: 0.5rem 1.25rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.85rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.2s;
        border: 1px solid transparent;
        background: rgba(255,255,255,0.6);
        color: var(--stone-text);
        border-color: rgba(255,255,255,0.8);
    }
    .header-btn:hover {
        background: white;
        transform: translateY(-2px);
    }
    .btn-action-primary {
        background: var(--stone-primary);
        color: white;
        border: none;
    }
    .btn-action-primary:hover {
        background: var(--stone-secondary);
        color: white;
    }

    /* Content Body */
    .detail-body {
        padding: 2rem;
    }

    /* Section Title */
    .section-title {
        font-size: 0.9rem;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--stone-primary);
        border-bottom: 2px solid var(--stone-light);
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
        margin-top: 1rem;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
    }
    .section-title i { margin-right: 0.5rem; }

    /* Data Fields */
    .data-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #8D6E63;
        text-transform: uppercase;
        margin-bottom: 0.2rem;
    }
    .data-value {
        font-size: 0.95rem;
        color: #3E2723;
        font-weight: 500;
        margin-bottom: 1rem;
        word-break: break-word;
    }
    .data-value-large {
        font-size: 1.1rem;
        font-weight: 600;
    }

    /* Mini Cards (Contactos, etc) */
    .mini-card {
        background: #fdfbf7;
        border: 1px solid var(--stone-light);
        border-radius: 10px;
        padding: 1rem;
        height: 100%;
        transition: all 0.2s;
    }
    .mini-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(139,115,85,0.1);
    }
    
    /* Badges */
    .badge-stone {
        padding: 5px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .bg-stone-success { background: #E8F5E9; color: #2E7D32; border: 1px solid #C8E6C9; }
    .bg-stone-warning { background: #FFF8E1; color: #F57F17; border: 1px solid #FFECB3; }
    .bg-stone-danger { background: #FFEBEE; color: #C62828; border: 1px solid #FFCDD2; }
    .bg-stone-info { background: #E3F2FD; color: #1565C0; border: 1px solid #BBDEFB; }

</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-3">
    
    <!-- CARD PRINCIPAL -->
    <div class="single-card-container">
        
        <!-- HEADER PREMIUM -->
        <div class="stone-header-premium">
            <div class="header-content">
                <div class="header-icon-box">
                    <i class="fas fa-file-contract"></i>
                </div>
                <div class="header-text">
                    <h1>
                        <span class="fw-light">Ficha de</span> <span class="fw-bold">Proveedor</span>
                    </h1>
                    <p>Vista detallada de información y contactos.</p>
                </div>
            </div>
            <div class="header-actions d-flex gap-2">
                <a href="{% url 'proveedores:proveedor_list' %}" class="header-btn">
                    <i class="fas fa-arrow-left me-2"></i> Volver
                </a>
                <a href="{% url 'proveedores:proveedor_update' proveedor.pk %}" class="header-btn btn-action-primary">
                    <i class="fas fa-edit me-2"></i> Editar
                </a>
            </div>
        </div>

        <div class="detail-body">
            
            <div class="row">
                <!-- COLUMNA IZQUIERDA: DATOS PRINCIPALES -->
                <div class="col-lg-8 border-end" style="border-color: #E8DCC8 !important;">
                    
                    <div class="section-title mt-0">
                        <i class="fas fa-info-circle"></i> Información General
                    </div>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <div class="data-label">Razón Social</div>
                            <div class="data-value data-value-large">{{ proveedor.razon_social|default:"-" }}</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Nombre Fantasía</div>
                            <div class="data-value">{{ proveedor.nombre }}</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">RUT</div>
                            <div class="data-value fw-bold" style="color: var(--stone-primary);">{{ proveedor.get_rut_formateado }}</div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="data-label">Giro Comercial</div>
                            <div class="data-value">{{ proveedor.giro }}</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Tipo</div>
                            <div class="data-value"><span class="badge-stone bg-stone-info">{{ proveedor.get_tipo_proveedor_display }}</span></div>
                        </div>
                         <div class="col-md-3">
                            <div class="data-label">Estado</div>
                            <div class="data-value">
                                <span class="badge-stone {% if proveedor.estado == 'activo' %}bg-stone-success{% else %}bg-stone-danger{% endif %}">
                                    {{ proveedor.get_estado_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <div class="data-label">Dirección</div>
                            <div class="data-value">{{ proveedor.direccion }}</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Comuna / Ciudad</div>
                            <div class="data-value">{{ proveedor.comuna }}, {{ proveedor.ciudad }}</div>
                        </div>
                        <div class="col-md-3">
                             <div class="data-label">Región</div>
                             <div class="data-value">{{ proveedor.region|default:"-" }}</div>
                        </div>
                         <div class="col-md-2">
                             <div class="data-label">F. Alta</div>
                             <div class="data-value">{{ proveedor.fecha_alta|date:"d/m/Y" }}</div>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                             <div class="data-label">Email</div>
                             <div class="data-value">
                                 {% if proveedor.email %}
                                    <a href="mailto:{{ proveedor.email }}" style="color: var(--stone-primary); text-decoration: none;"><i class="fas fa-envelope me-1"></i> {{ proveedor.email }}</a>
                                 {% else %}-{% endif %}
                             </div>
                        </div>
                        <div class="col-md-4">
                             <div class="data-label">Teléfono</div>
                             <div class="data-value">{{ proveedor.telefono|default:"-" }}</div>
                        </div>
                        <div class="col-md-4">
                             <div class="data-label">Sitio Web</div>
                             <div class="data-value">
                                 {% if proveedor.sitio_web %}
                                    <a href="{{ proveedor.get_sitio_web_formateado }}" target="_blank" style="color: var(--stone-primary); text-decoration: none;"><i class="fas fa-external-link-alt me-1"></i> {{ proveedor.sitio_web }}</a>
                                 {% else %}-{% endif %}
                             </div>
                        </div>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-handshake"></i> Datos Comerciales
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="data-label">Plazo Entrega</div>
                            <div class="data-value">{{ proveedor.plazo_entrega|default:"0" }} días</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Condic. Pago</div>
                            <div class="data-value">{{ proveedor.condiciones_pago|default:"-" }}</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Desc. Base</div>
                            <div class="data-value fw-bold">{{ proveedor.descuento_porcentaje|default:"0" }}%</div>
                        </div>
                        <div class="col-md-3">
                            <div class="data-label">Calificación</div>
                            <div class="data-value text-warning">
                                <span class="fw-bold text-dark me-1">{{ proveedor.calificacion }}</span>
                                {{ proveedor.get_calificacion_estrellas|safe }}
                            </div>
                        </div>
                        <div class="col-12">
                             <div class="data-label">Calidad & Observaciones</div>
                             <div class="data-value text-muted fst-italic">
                                 {{ proveedor.observaciones_calidad|default:"Sin observaciones de calidad." }}
                             </div>
                        </div>
                    </div>

                </div>

                <!-- COLUMNA DERECHA: CONTACTOS Y OTROS -->
                <div class="col-lg-4 ps-lg-4">
                     
                     <div class="section-title mt-0">
                        <i class="fas fa-users"></i> Contactos
                    </div>
                    
                    <div class="d-flex flex-column gap-3">
                        {% for contacto in contactos %}
                            <div class="mini-card position-relative">
                                {% if contacto.es_contacto_principal %}
                                    <span class="position-absolute top-0 end-0 badge-stone bg-stone-warning m-2" style="font-size: 0.6rem;">Principal</span>
                                {% endif %}
                                <div class="fw-bold text-dark mb-1">{{ contacto.nombre }}</div>
                                <div class="small text-muted mb-2">{{ contacto.cargo|default:"Cargo no especificado" }}</div>
                                
                                <div class="small mb-1"><i class="fas fa-envelope me-2 text-muted"></i> {{ contacto.email|default:"-" }}</div>
                                <div class="small mb-1"><i class="fas fa-phone me-2 text-muted"></i> {{ contacto.telefono|default:"-" }}</div>
                                <div class="small"><i class="fas fa-mobile-alt me-2 text-muted"></i> {{ contacto.celular|default:"-" }}</div>
                            </div>
                        {% empty %}
                            <div class="text-muted text-center py-4 border rounded bg-light">
                                <i class="fas fa-user-slash mb-2"></i><br>
                                <small>No hay contactos registrados.</small>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="section-title mt-4">
                        <i class="fas fa-tags"></i> Categorías
                    </div>
                    
                    {% if categorias %}
                         <div class="d-flex flex-wrap gap-2">
                            {% for cat in categorias %}
                                <span class="badge-stone bg-stone-info">{{ cat.descripcion }}</span>
                            {% endfor %}
                         </div>
                    {% else %}
                        <div class="text-muted small">Sin categorías asignadas.</div>
                    {% endif %}

                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}
