{% extends "base.html" %}
{% load static %}
{% load format_filters %}

{% block title %}Detalle del Proveedor{% endblock %}

{% block body_class %}hide-top-bar{% endblock %}

{% block extra_css %}
<style>
    /* Paleta terrosa para proveedores */
    .stat-card {
        border: none;
        border-radius: 12px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .stat-card-1 {
        background: linear-gradient(135deg, #D4A574 0%, #C19461 100%);
    }

    .stat-card-2 {
        background: linear-gradient(135deg, #B8956A 0%, #A67C52 100%);
    }

    .stat-card-3 {
        background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%);
    }

    .nav-tabs-compact {
        border-bottom: 2px solid #D4C4A8;
        margin-bottom: 15px;
    }

    .nav-tabs-compact .nav-link {
        border: none;
        border-radius: 0;
        padding: 8px 16px;
        font-weight: 500;
        font-size: 0.85rem;
        color: #6F5B44;
        background: transparent;
    }

    .nav-tabs-compact .nav-link.active {
        background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%);
        color: white;
    }

    .detail-info {
        background: #FAFAF8;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 8px;
    }

    .detail-info h6 {
        color: #6F5B44;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 8px;
        border-bottom: 1px solid #D4C4A8;
        padding-bottom: 4px;
    }

    .detail-row {
        display: flex;
        margin-bottom: 4px;
        font-size: 0.8rem;
    }

    .detail-label {
        font-weight: 600;
        color: #8B7355;
        min-width: 120px;
    }

    .detail-value {
        color: #6F5B44;
        flex: 1;
    }

    .btn-compact {
        padding: 6px 16px;
        font-size: 0.8rem;
        border-radius: 6px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm" style="border: 2px solid #E8DCC8; border-radius: 15px; overflow: hidden;">

                <!-- HEADER PRINCIPAL -->
                <div class="card-header" style="background: linear-gradient(135deg, #F5F1E8 0%, #E8DCC8 100%); border: none; border-bottom: 2px solid #D4C4A8; padding: 10px 15px; font-family: 'Poppins', sans-serif;">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-truck fa-lg me-2" style="color: #6F5B44;"></i>
                            <div>
                                <h5 class="mb-0" style="font-size: 1.1rem; font-family: 'Poppins', sans-serif; font-weight: 600; color: #6F5B44;">
                                    {{ proveedor.nombre }}
                                </h5>
                                <small style="font-size: 0.75rem; font-family: 'Poppins', sans-serif; color: #8B7355;">
                                    {{ proveedor.get_rut_formateado }} - {{ proveedor.get_tipo_proveedor_display }}
                                </small>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm me-2" style="background: rgba(111, 91, 68, 0.15); border: 1px solid rgba(111, 91, 68, 0.25); color: #6F5B44; padding: 4px 8px; font-size: 0.7rem;" onclick="window.print()">
                                <i class="fas fa-print me-1"></i>
                            </button>
                            <a href="{% url 'proveedores:proveedor_list' %}" class="btn btn-sm me-2" style="background: rgba(139, 115, 85, 0.15); border: 1px solid rgba(139, 115, 85, 0.25); color: #8B7355; padding: 4px 8px; font-size: 0.7rem;">
                                <i class="fas fa-arrow-left me-1"></i> Volver
                            </a>
                            <a href="{% url 'proveedores:proveedor_update' proveedor.pk %}" class="btn btn-sm" style="background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%); border: none; color: white; padding: 4px 8px; font-size: 0.7rem;">
                                <i class="fas fa-edit me-1"></i> Editar
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card-body" style="padding: 15px; background: #FAFAF8;">

                    <!-- Pestañas compactas -->
                    <ul class="nav nav-tabs nav-tabs-compact" id="proveedorDetailTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="info-general-tab" data-bs-toggle="tab" data-bs-target="#info-general" type="button" role="tab">
                                <i class="fas fa-info-circle me-1"></i>Información General
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="datos-comerciales-tab" data-bs-toggle="tab" data-bs-target="#datos-comerciales" type="button" role="tab">
                                <i class="fas fa-chart-line me-1"></i>Comerciales
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="contactos-tab" data-bs-toggle="tab" data-bs-target="#contactos" type="button" role="tab">
                                <i class="fas fa-address-book me-1"></i>Contactos ({{ contactos.count }})
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="evaluaciones-tab" data-bs-toggle="tab" data-bs-target="#evaluaciones" type="button" role="tab">
                                <i class="fas fa-star me-1"></i>Evaluaciones
                            </button>
                        </li>
                    </ul>

                    <!-- Contenido de las pestañas -->
                    <div class="tab-content" id="proveedorDetailTabsContent" style="font-family: 'Poppins', sans-serif;">
                        <!-- Pestaña 1: Información General -->
                        <div class="tab-pane fade show active" id="info-general" role="tabpanel">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-truck me-2"></i>Datos del Proveedor</h6>
                                        <div class="detail-row">
                                            <span class="detail-label">Nombre:</span>
                                            <span class="detail-value">{{ proveedor.nombre }}</span>
                                        </div>
                                        {% if proveedor.razon_social %}
                                        <div class="detail-row">
                                            <span class="detail-label">Razón Social:</span>
                                            <span class="detail-value">{{ proveedor.razon_social }}</span>
                                        </div>
                                        {% endif %}
                                        <div class="detail-row">
                                            <span class="detail-label">RUT:</span>
                                            <span class="detail-value">{{ proveedor.get_rut_formateado }}</span>
                                        </div>
                                        {% if proveedor.giro %}
                                        <div class="detail-row">
                                            <span class="detail-label">Giro:</span>
                                            <span class="detail-value">{{ proveedor.giro }}</span>
                                        </div>
                                        {% endif %}
                                        <div class="detail-row">
                                            <span class="detail-label">Tipo:</span>
                                            <span class="detail-value">
                                                <span class="badge bg-info">{{ proveedor.get_tipo_proveedor_display }}</span>
                                            </span>
                                        </div>
                                        {% if proveedor.categoria_principal %}
                                        <div class="detail-row">
                                            <span class="detail-label">Categoría:</span>
                                            <span class="detail-value">{{ proveedor.categoria_principal }}</span>
                                        </div>
                                        {% endif %}
                                        <div class="detail-row">
                                            <span class="detail-label">Estado:</span>
                                            <span class="detail-value">
                                                <span class="badge {% if proveedor.estado == 'activo' %}bg-success{% elif proveedor.estado == 'inactivo' %}bg-secondary{% elif proveedor.estado == 'suspendido' %}bg-warning{% else %}bg-danger{% endif %}">
                                                    {{ proveedor.get_estado_display }}
                                                </span>
                                            </span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Fecha de Alta:</span>
                                            <span class="detail-value">{{ proveedor.fecha_alta|date:"d/m/Y" }}</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-map-marker-alt me-2"></i>Información de Contacto</h6>
                                        <div class="detail-row">
                                            <span class="detail-label">Dirección:</span>
                                            <span class="detail-value">{{ proveedor.direccion }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Comuna:</span>
                                            <span class="detail-value">{{ proveedor.comuna }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Ciudad:</span>
                                            <span class="detail-value">{{ proveedor.ciudad }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Región:</span>
                                            <span class="detail-value">{{ proveedor.region }}</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Teléfono:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-phone me-1"></i>{{ proveedor.telefono }}
                                            </span>
                                        </div>
                                        {% if proveedor.email %}
                                        <div class="detail-row">
                                            <span class="detail-label">Email:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-envelope me-1"></i>
                                                <a href="mailto:{{ proveedor.email }}">{{ proveedor.email }}</a>
                                            </span>
                                        </div>
                                        {% endif %}
                                        {% if proveedor.sitio_web %}
                                        <div class="detail-row">
                                            <span class="detail-label">Sitio Web:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-globe me-1"></i>
                                                <a href="{{ proveedor.get_sitio_web_formateado }}" target="_blank">{{ proveedor.sitio_web }}</a>
                                            </span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            {% if proveedor.observaciones %}
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-sticky-note me-2"></i>Observaciones Generales</h6>
                                        <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; border-left: 3px solid #8B4513; font-size: 0.85rem;">
                                            {{ proveedor.observaciones|linebreaks }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Pestaña 2: Datos Comerciales -->
                        <div class="tab-pane fade" id="datos-comerciales" role="tabpanel">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-chart-line me-2"></i>Condiciones Comerciales</h6>
                                        {% if proveedor.plazo_entrega %}
                                        <div class="detail-row">
                                            <span class="detail-label">Plazo de Entrega:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-clock me-1"></i>{{ proveedor.plazo_entrega }}
                                            </span>
                                        </div>
                                        {% endif %}
                                        {% if proveedor.condiciones_pago %}
                                        <div class="detail-row">
                                            <span class="detail-label">Condiciones de Pago:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-credit-card me-1"></i>{{ proveedor.condiciones_pago }}
                                            </span>
                                        </div>
                                        {% endif %}
                                        <div class="detail-row">
                                            <span class="detail-label">Descuento por Defecto:</span>
                                            <span class="detail-value">
                                                <i class="fas fa-percentage me-1"></i>{{ proveedor.descuento_porcentaje }}%
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-star me-2"></i>Calificación</h6>
                                        <div class="detail-row">
                                            <span class="detail-label">Calificación:</span>
                                            <span class="detail-value">
                                                <div class="d-flex align-items-center">
                                                    <span class="me-2" style="color: #ffc107; font-size: 1rem;">{{ proveedor.get_calificacion_estrellas }}</span>
                                                    <span style="font-weight: 600;">{{ proveedor.calificacion }}/5</span>
                                                </div>
                                            </span>
                                        </div>
                                        {% if proveedor.observaciones_calidad %}
                                        <div class="detail-row">
                                            <span class="detail-label">Observaciones de Calidad:</span>
                                            <span class="detail-value">{{ proveedor.observaciones_calidad|linebreaks }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Categorías del proveedor -->
                            {% if categorias %}
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="detail-info">
                                        <h6><i class="fas fa-folder me-2"></i>Categorías</h6>
                                        <div class="row g-2">
                                            {% for categoria in categorias %}
                                            <div class="col-md-6">
                                                <div style="border: 1px solid #D4C4A8; border-radius: 6px; padding: 8px; background: #FAFAF8;">
                                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                                        <div class="d-flex align-items-center">
                                                            {% if categoria.es_categoria_principal %}
                                                                <i class="fas fa-star text-warning me-2" style="font-size: 0.8rem;"></i>
                                                            {% endif %}
                                                            <span style="font-weight: 600; font-size: 0.85rem;">Categoría</span>
                                                        </div>
                                                        <span class="badge {% if categoria.activa %}bg-success{% else %}bg-secondary{% endif %}" style="font-size: 0.7rem;">
                                                            {% if categoria.activa %}Activa{% else %}Inactiva{% endif %}
                                                        </span>
                                                    </div>
                                                    {% if categoria.descripcion %}
                                                        <p class="mb-2" style="font-size: 0.8rem; color: #6F5B44; margin-bottom: 6px;">{{ categoria.descripcion }}</p>
                                                    {% endif %}
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small style="color: #8B7355; font-size: 0.75rem;">
                                                            <i class="fas fa-percentage me-1"></i>
                                                            Descuento: {{ categoria.descuento_categoria }}%
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Pestaña 3: Contactos -->
                        <div class="tab-pane fade" id="contactos" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 style="color: #2c3e50; font-weight: 600; margin-bottom: 0;">
                                            <i class="fas fa-address-book me-2" style="color: #8B4513;"></i>Contactos del Proveedor
                                        </h6>
                                        <button type="button" class="btn btn-sm btn-compact" style="background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%);" data-bs-toggle="modal" data-bs-target="#contactoModal">
                                            <i class="fas fa-plus me-1"></i>Agregar Contacto
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            {% if contactos %}
                                <div class="row g-2">
                                    {% for contacto in contactos %}
                                    <div class="col-md-6">
                                        <div style="border: 1px solid #D4C4A8; border-radius: 8px; padding: 12px; background: #FAFAF8; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#8B4513'; this.style.background='#F5F1E8';" onmouseout="this.style.borderColor='#D4C4A8'; this.style.background='#FAFAF8';">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div class="d-flex align-items-center">
                                                    {% if contacto.es_contacto_principal %}
                                                        <i class="fas fa-star text-warning me-2" style="font-size: 0.8rem;"></i>
                                                    {% endif %}
                                                    <h6 class="mb-0" style="font-weight: 600; font-size: 0.9rem; color: #6F5B44;">{{ contacto.nombre }}</h6>
                                                </div>
                                                <div class="btn-group btn-group-sm">
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="editarContacto({{ contacto.id }})" style="padding: 2px 6px; font-size: 0.7rem;">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarContacto({{ contacto.id }})" style="padding: 2px 6px; font-size: 0.7rem;">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            {% if contacto.cargo %}
                                            <div class="mb-1">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-briefcase me-1"></i>Cargo:</strong>
                                                <span style="color: #6F5B44; font-size: 0.8rem;">{{ contacto.cargo }}</span>
                                            </div>
                                            {% endif %}

                                            <div class="mb-1">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-tags me-1"></i>Tipo:</strong>
                                                <span class="badge bg-info" style="font-size: 0.7rem;">{{ contacto.get_tipo_contacto_display }}</span>
                                            </div>

                                            {% if contacto.telefono %}
                                            <div class="mb-1">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-phone me-1"></i>Teléfono:</strong>
                                                <span style="color: #6F5B44; font-size: 0.8rem;">{{ contacto.telefono }}</span>
                                            </div>
                                            {% endif %}

                                            {% if contacto.celular %}
                                            <div class="mb-1">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-mobile-alt me-1"></i>Celular:</strong>
                                                <span style="color: #6F5B44; font-size: 0.8rem;">{{ contacto.celular }}</span>
                                            </div>
                                            {% endif %}

                                            {% if contacto.email %}
                                            <div class="mb-1">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-envelope me-1"></i>Email:</strong>
                                                <a href="mailto:{{ contacto.email }}" style="color: #8B4513; font-size: 0.8rem;">{{ contacto.email }}</a>
                                            </div>
                                            {% endif %}

                                            {% if contacto.observaciones %}
                                            <div class="mt-2 pt-2" style="border-top: 1px solid #D4C4A8;">
                                                <strong style="color: #8B7355; font-size: 0.75rem;"><i class="fas fa-sticky-note me-1"></i>Observaciones:</strong>
                                                <p style="color: #6F5B44; font-size: 0.8rem; margin-bottom: 0; margin-top: 4px;">{{ contacto.observaciones }}</p>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-3">
                                    <i class="fas fa-inbox fa-2x mb-2" style="color: #D4A574;"></i>
                                    <p style="color: #8B7355; font-size: 0.8rem;">No hay contactos registrados</p>
                                    <button type="button" class="btn btn-sm btn-compact" style="background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%);" data-bs-toggle="modal" data-bs-target="#contactoModal">
                                        <i class="fas fa-plus me-1"></i>Agregar Contacto
                                    </button>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Pestaña 4: Evaluaciones -->
                        <div class="tab-pane fade" id="evaluaciones" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <h6 style="color: #2c3e50; font-weight: 600; margin-bottom: 0;">
                                        <i class="fas fa-star me-2" style="color: #8B4513;"></i>Evaluaciones del Proveedor
                                    </h6>
                                </div>
                            </div>
                            
                            {% if evaluaciones %}
                                <div class="row g-2">
                                    {% for evaluacion in evaluaciones %}
                                    <div class="col-12">
                                        <div style="border: 1px solid #D4C4A8; border-radius: 8px; padding: 12px; background: #FAFAF8;">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <h6 class="mb-1" style="font-weight: 600; font-size: 0.9rem; color: #6F5B44;">{{ evaluacion.periodo_evaluado }}</h6>
                                                    <small style="color: #8B7355;">{{ evaluacion.fecha_evaluacion|date:"d/m/Y" }}</small>
                                                </div>
                                                <div class="text-end">
                                                    <span class="badge {% if evaluacion.calificacion_general >= 4 %}bg-success{% elif evaluacion.calificacion_general >= 3 %}bg-warning{% elif evaluacion.calificacion_general >= 2 %}bg-info{% else %}bg-danger{% endif %} me-2" style="font-size: 0.7rem;">
                                                        {{ evaluacion.calificacion_general }}/5
                                                    </span>
                                                    <span class="badge {% if evaluacion.recomendacion == 'mantener' %}bg-success{% elif evaluacion.recomendacion == 'mejorar' %}bg-warning{% elif evaluacion.recomendacion == 'revisar' %}bg-info{% else %}bg-danger{% endif %}" style="font-size: 0.7rem;">
                                                        {{ evaluacion.get_recomendacion_display }}
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="row g-2">
                                                <div class="col-md-6">
                                                    <h6 style="color: #6F5B44; font-size: 0.8rem; font-weight: 600; margin-bottom: 8px;">Criterios de Evaluación:</h6>
                                                    <div class="mb-1">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Calidad:</strong>
                                                        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">{{ evaluacion.calidad_productos }}/5</span>
                                                    </div>
                                                    <div class="mb-1">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Plazos:</strong>
                                                        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">{{ evaluacion.cumplimiento_plazos }}/5</span>
                                                    </div>
                                                    <div class="mb-1">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Atención:</strong>
                                                        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">{{ evaluacion.atencion_cliente }}/5</span>
                                                    </div>
                                                    <div class="mb-1">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Precios:</strong>
                                                        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">{{ evaluacion.precios_competitivos }}/5</span>
                                                    </div>
                                                    <div class="mb-1">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Problemas:</strong>
                                                        <span class="badge bg-secondary ms-2" style="font-size: 0.7rem;">{{ evaluacion.resolucion_problemas }}/5</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    {% if evaluacion.fortalezas %}
                                                    <div class="mb-2">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Fortalezas:</strong>
                                                        <p style="color: #6F5B44; font-size: 0.8rem; margin-bottom: 0; margin-top: 4px;">{{ evaluacion.fortalezas }}</p>
                                                    </div>
                                                    {% endif %}

                                                    {% if evaluacion.areas_mejora %}
                                                    <div class="mb-2">
                                                        <strong style="color: #8B7355; font-size: 0.75rem;">Áreas de Mejora:</strong>
                                                        <p style="color: #6F5B44; font-size: 0.8rem; margin-bottom: 0; margin-top: 4px;">{{ evaluacion.areas_mejora }}</p>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>

                                            {% if evaluacion.comentarios_generales %}
                                            <div class="mt-2 pt-2" style="border-top: 1px solid #D4C4A8;">
                                                <strong style="color: #8B7355; font-size: 0.75rem;">Comentarios:</strong>
                                                <p style="color: #6F5B44; font-size: 0.8rem; margin-bottom: 0; margin-top: 4px;">{{ evaluacion.comentarios_generales }}</p>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <div class="text-center py-3">
                                    <i class="fas fa-inbox fa-2x mb-2" style="color: #D4A574;"></i>
                                    <p style="color: #8B7355; font-size: 0.8rem;">No hay evaluaciones registradas</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para contacto -->
<div class="modal fade" id="contactoModal" tabindex="-1" aria-labelledby="contactoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #8B7355 0%, #6F5B44 100%); color: white;">
                <h5 class="modal-title" id="contactoModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Agregar Contacto
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="contactoModalBody">
                <!-- El contenido se carga dinámicamente -->
            </div>
        </div>
    </div>
</div>

<style>
.badge-success {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
    color: white !important;
}

.badge-warning {
    background: linear-gradient(135deg, #ffc107 0%, #ffb347 100%) !important;
    color: white !important;
}

.badge-danger {
    background: linear-gradient(135deg, #dc3545 0%, #ff6b6b 100%) !important;
    color: white !important;
}

.badge-secondary {
    background: linear-gradient(135deg, #6c757d 0%, #adb5bd 100%) !important;
    color: white !important;
}

.badge-info {
    background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%) !important;
    color: white !important;
}
</style>

<script>
function editarContacto(contactoId) {
    // Implementar edición de contacto
    window.location.href = "{% url 'proveedores:contacto_update' proveedor.pk 0 %}".replace('0', contactoId);
}

function eliminarContacto(contactoId) {
    if (confirm('¿Estás seguro de que quieres eliminar este contacto?')) {
        window.location.href = "{% url 'proveedores:contacto_delete' proveedor.pk 0 %}".replace('0', contactoId);
    }
}

// Modal para agregar contacto
document.getElementById('contactoModal').addEventListener('show.bs.modal', function () {
    const modalBody = document.getElementById('contactoModalBody');
    modalBody.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div></div>';
    
    fetch("{% url 'proveedores:contacto_create' proveedor.pk %}")
        .then(response => response.text())
        .then(html => {
            modalBody.innerHTML = html;
        })
        .catch(error => {
            modalBody.innerHTML = '<div class="alert alert-danger">Error al cargar el formulario.</div>';
        });
});
</script>
{% endblock %}
