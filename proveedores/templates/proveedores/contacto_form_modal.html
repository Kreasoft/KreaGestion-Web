{% extends "base.html" %}
{% load static %}

{% block title %}Contacto de Proveedor{% endblock %}

{% block body_class %}hide-top-bar{% endblock %}

{% block content %}
<div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white;">
            <h5 class="modal-title" style="font-family: 'Poppins', sans-serif;">
                <i class="fas fa-user-plus me-2"></i>
                {% if contacto %}Editar Contacto{% else %}Agregar Contacto{% endif %}
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <form method="post" id="contactoForm">
            <div class="modal-body" style="padding: 20px; font-family: 'Poppins', sans-serif;">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.nombre.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-user me-2" style="color: #8B4513;"></i>Nombre del Contacto *
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-user" style="color: #6c757d;"></i>
                            </div>
                            {{ form.nombre }}
                        </div>
                        {% if form.nombre.errors %}
                            <div class="text-danger mt-1">{{ form.nombre.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.cargo.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-briefcase me-2" style="color: #8B4513;"></i>Cargo
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-briefcase" style="color: #6c757d;"></i>
                            </div>
                            {{ form.cargo }}
                        </div>
                        {% if form.cargo.errors %}
                            <div class="text-danger mt-1">{{ form.cargo.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.tipo_contacto.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-tags me-2" style="color: #8B4513;"></i>Tipo de Contacto
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-tags" style="color: #6c757d;"></i>
                            </div>
                            {{ form.tipo_contacto }}
                        </div>
                        {% if form.tipo_contacto.errors %}
                            <div class="text-danger mt-1">{{ form.tipo_contacto.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.es_contacto_principal }}
                            <label class="form-check-label" for="{{ form.es_contacto_principal.id_for_label }}" style="font-weight: 600; color: #495057;">
                                <i class="fas fa-star me-2" style="color: #ffc107;"></i>Es Contacto Principal
                            </label>
                        </div>
                        {% if form.es_contacto_principal.errors %}
                            <div class="text-danger mt-1">{{ form.es_contacto_principal.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.telefono.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-phone me-2" style="color: #8B4513;"></i>Teléfono
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-phone" style="color: #6c757d;"></i>
                            </div>
                            {{ form.telefono }}
                        </div>
                        {% if form.telefono.errors %}
                            <div class="text-danger mt-1">{{ form.telefono.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.celular.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-mobile-alt me-2" style="color: #8B4513;"></i>Celular
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-mobile-alt" style="color: #6c757d;"></i>
                            </div>
                            {{ form.celular }}
                        </div>
                        {% if form.celular.errors %}
                            <div class="text-danger mt-1">{{ form.celular.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.email.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-envelope me-2" style="color: #8B4513;"></i>Email
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da;">
                                <i class="fas fa-envelope" style="color: #6c757d;"></i>
                            </div>
                            {{ form.email }}
                        </div>
                        {% if form.email.errors %}
                            <div class="text-danger mt-1">{{ form.email.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="col-12 mb-3">
                        <label for="{{ form.observaciones.id_for_label }}" class="form-label" style="font-weight: 600; color: #495057;">
                            <i class="fas fa-sticky-note me-2" style="color: #8B4513;"></i>Observaciones
                        </label>
                        <div class="input-group">
                            <div class="input-group-text" style="background-color: #f8f9fa; border-right: 2px solid #dee2e6; border-color: #ced4da; align-items: flex-start; padding-top: 12px;">
                                <i class="fas fa-sticky-note" style="color: #6c757d;"></i>
                            </div>
                            {{ form.observaciones }}
                        </div>
                        {% if form.observaciones.errors %}
                            <div class="text-danger mt-1">{{ form.observaciones.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="modal-footer" style="background: #f8f9fa; border: none; padding: 15px 20px;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 6px; font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="submit" class="btn" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); border: none; color: white; border-radius: 6px; font-family: 'Poppins', sans-serif;">
                    <i class="fas fa-save me-2"></i>
                    {% if contacto %}Actualizar Contacto{% else %}Agregar Contacto{% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Manejar envío del formulario
    document.getElementById('contactoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            }
        })
        .then(response => {
            if (response.ok) {
                // Cerrar modal y recargar página
                const modal = bootstrap.Modal.getInstance(document.getElementById('contactoModal'));
                modal.hide();
                window.location.reload();
            } else {
                // Mostrar errores
                response.text().then(html => {
                    document.querySelector('.modal-body').innerHTML = html;
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al procesar la solicitud');
        });
    });
});
</script>
{% endblock %}
